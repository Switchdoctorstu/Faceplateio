<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Message App V0.1</title>
    Stuart's IOT Server
</head>
<body>
    <div>
        <input id="Button55" type="button" value="Panel" onclick="window.open('MyPanel.aspx', 'Panel');" />

    </div>
    <div>
        <input id="Button1" type="button" value="Devices" onclick="window.open('MyDevices.aspx', 'Devices');"/>
    </div>
    <div>
        <input id="Button2" type="button" value="Create Account" onclick="window.open('CreateAccount.aspx', 'Accounts');" />
    </div>

    <div>
        <input id="Button3" type="button" value="Buttons" onclick="window.open('MyButtons.aspx', 'Buttons');" />

    </div>
    <div>
        <input id="Button4" type="button" value="Scripts" onclick="window.open('MyScripts.aspx', 'Scripts');" />

    </div>
    <div>
        <h2>All Messages</h2>
        <p>&nbsp;</p>

        <ul id="messages" />
    </div>
    <div>
        <h2>Search by ID</h2>
        <input type="text" id="msgId" size="5" />
        <input type="button" value="Search" onclick="find();" /><hr />
        <br />
        New Message:<br />
        <br />
        From<br />
        <input id="FromText" type="text" /><br />
        To<br />
        <input id="ToText" type="text" /><br />
        Message<br />
        <input id="MessageText" type="text" /><br />
        <br />
        <input id="Button3" type="button" value="Submit" onclick="trythis();"/>
        <p id="message" />
    </div>

    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script>
    var uri = 'api/io';

    $(document).ready(function () {
      // Send an AJAX request
      $.getJSON(uri)
          .done(function (data) {
            // On success, 'data' contains a list of messages
            $.each(data, function (message) {
              // Add a list item for the product.
              $('<li>', { text: formatItem(message) }).appendTo($('#messages'));
            });
          });
    });

    function formatItem(item) {
      return item.Msg;
    }

    function find() {
      var id = $('#msgId').val();
      $.getJSON(uri + '/?Mto=' + id)
          .done(function (data) {
            $('#message').text(formatItem(data));
          })
          .fail(function (jqXHR, textStatus, err) {
            $('#message').text('Error: ' + err);
          });
    }

    function trythis() {
        var uri = 'api/io/';
        var valid = true;
        var mfrom = $('#FromText').val();
        var mto = $('#ToText').val();
        var mmsg = $('#MessageText').val();
        $('#message').text('Evaluating: ');  // set status message

        // test From
        if (mfrom.length == 0) {
            $('#message').text('From is Empty: ');
            valid=false;
        }
        //Test To
        if (mto.length == 0) {
            $('#message').text('To is Empty: ');
            valid = false;
        }
        // Test Message
        if (mmsg.length == 0) {
            $('#message').text('MSG is Empty: ');
            valid = false;
        }

        if (valid == true) {
           
            var req = uri;
            req += '/?from=';
            req += mfrom;
            req += '&to=' + mto + '&msg=' + mmsg;

            $.getJSON(req)
                .done(function (data) {
                    $('#messages').text(formatItem(data));
                    $('#message').text('Record Sent');
                })
                .fail(function (jqXHR, textStatus, err) {
                    $('#message').text('Error: ' + err);
                });
        }
    }
    </script>
</body>
</html>
